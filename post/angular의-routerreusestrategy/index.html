<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.70afe56b9d06035a5b06.css">.tl-edges{max-width:100%;overflow-x:hidden}.tl-wrapper{width:100%;float:left;position:relative}.tl-wrapper+.tl-wrapper{margin-left:-100%;margin-right:0}a,abbr,acronym,address,applet,article,aside,audio,b,big,blockquote,body,canvas,caption,center,cite,code,dd,del,details,dfn,div,dl,dt,em,embed,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hgroup,html,i,iframe,img,ins,kbd,label,legend,li,mark,menu,nav,object,ol,output,p,pre,q,ruby,s,samp,section,small,span,strike,strong,sub,summary,sup,table,tbody,td,tfoot,th,thead,time,tr,tt,u,ul,var,video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}body{line-height:1}blockquote,q{quotes:none}blockquote:after,blockquote:before,q:after,q:before{content:"";content:none}table{border-collapse:collapse;border-spacing:0}.aspect-ratio{position:relative;width:100%;height:0;margin:0 0 2rem;padding-bottom:56.25%}.aspect-ratio iframe{position:absolute;width:100%;height:100%;left:0;top:0}@font-face{font-family:JetBrains Mono;font-weight:400;font-style:normal;src:url(/JetBrainsMono-Regular.woff2) format("woff2"),url(/JetBrainsMono-Regular.woff) format("woff"),url(/JetBrainsMono-Regular.eot) format("eot");font-display:swap}*,:after,:before,html{box-sizing:border-box}body{font-family:Noto Sans KR,sans-serif;line-height:1.6;color:#333}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:2rem;font-weight:700}h1{font-size:2rem}h1,h2{line-height:1.2em}h2{font-size:1.8rem}h3{font-size:1.6rem}h3,h4{line-height:1.1em}h4{font-size:1.4rem}h5{font-size:1.2rem}h6{font-size:1rem}a{color:#4299e1;transition:color 80ms ease-out}a:hover{color:#2b6cb0}ol,ul{list-style:none;margin:0 0 2rem;padding:0 0 0 1.7rem;list-style-position:inside}ul{list-style:disc}ol ol,ol ul,ul ol,ul ul{margin:0 0 .5em}ol{list-style:decimal}em,strong{font-weight:600}.container{max-width:800px;padding:0 2rem;margin:0 auto}code[class*=language-],pre[class*=language-]{color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,pre[class*=language-]::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e}:not(pre)>code[class*=language-]{padding:.1em .3em;border-radius:.3em;color:#db4c69;background:#f9f2f4}.namespace{opacity:.7}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#6a9955}.token.punctuation{color:#d4d4d4}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#b5cea8}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#ce9178}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#d4d4d4;background:#1e1e1e}.token.atrule,.token.attr-value,.token.keyword{color:#c586c0}.token.function{color:#dcdcaa}.token.important,.token.regex,.token.variable{color:#d16969}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.constant{color:#9cdcfe}.token.class-name{color:#4ec9b0}.token.interpolation,.token.parameter{color:#9cdcfe}.token.boolean,.token.punctuation.interpolation-punctuation{color:#569cd6}.token.property{color:#9cdcfe}.token.selector{color:#d7ba7d}.token.tag{color:#569cd6}.token.attr-name{color:#9cdcfe}.token.attr-value{color:#ce9178}.token.entity{color:#4ec9b0;cursor:unset}.token.namespace,code[class*=language-javascript],pre[class*=language-javascript]{color:#4ec9b0}code[class*=language-css],pre[class*=language-css]{color:#ce9178}code[class*=language-html],pre[class*=language-html]{color:#d4d4d4}.language-html .token.punctuation{color:grey}pre[data-line]{position:relative}pre[class*=language-]>code[class*=language-]{position:relative;z-index:1}.line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:#f7ebc6;box-shadow:inset 5px 0 0 #f7d87c;z-index:0;pointer-events:none;line-height:inherit;white-space:pre}.markdown-content li p{margin:0}.markdown-content .gatsby-highlight,.markdown-content p{margin:0 0 2rem}.markdown-content blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.markdown-content figcaption{font-size:.8rem;color:#6a737d}code[class*=language-]{font-family:JetBrains Mono,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.gatsby-highlight pre[class*=language-]{padding-top:1.5rem;position:relative}.gatsby-highlight pre[class*=language-]:before{color:#232129;font-size:.75rem;font-family:JetBrains Mono,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;letter-spacing:.075em;line-height:1;position:absolute;left:1.5rem;text-align:right;text-transform:uppercase;top:0;border-radius:0 0 4px 4px;padding:.25rem .5rem;background:#fff;color:#000}.gatsby-highlight pre[class=language-javascript]:before,.gatsby-highlight pre[class=language-js]:before{content:"js";background:#f7df1e;color:#000}.gatsby-highlight pre[class~=language-jsx]:before{content:"jsx";background:#61dafb;color:#000}.gatsby-highlight pre[class~=language-ts]:before{content:"ts";background:#61dafb;color:#000}.gatsby-highlight pre[class~=language-tsx]:before{content:"tsx";background:#61dafb;color:#000}.gatsby-highlight pre[class~=language-html]:before{content:"html";background:#005a9c;color:#fff}.gatsby-highlight pre[class~=language-xml]:before{content:"xml";background:#005a9c;color:#fff}.gatsby-highlight pre[class~=language-svg]:before{content:"svg";background:#005a9c;color:#fff}.gatsby-highlight pre[class~=language-graphql]:before{content:"GraphQL";background:#e10098}.gatsby-highlight pre[class~=language-css]:before{content:"css";background:#ff9800;color:#000}.gatsby-highlight pre[class~=language-mdx]:before{content:"mdx";background:#f9ac00;color:#000}.gatsby-highlight pre[class~=language-text]:before{content:"text"}.gatsby-highlight pre[class~=language-shell]:before{content:"shell"}.gatsby-highlight pre[class~=language-sh]:before{content:"sh"}.gatsby-highlight pre[class~=language-bash]:before{content:"bash"}.gatsby-highlight pre[class~=language-yaml]:before{content:"yaml";background:#ffa8df}.gatsby-highlight pre[class~=language-yml]:before{content:"yml";background:#ffa8df}.gatsby-highlight pre[class~=language-markdown]:before{content:"md"}.gatsby-highlight pre[class~=language-json5]:before,.gatsby-highlight pre[class~=language-json]:before{content:"json";background:linen}.gatsby-highlight pre[class~=language-diff]:before{content:"diff";background:#e6ffed}</style><meta name="generator" content="Gatsby 2.21.33"/><style data-styled="" data-styled-version="5.1.0">.fmnWPj{height:56px;margin-bottom:30px;}/*!sc*/
.fmnWPj ul{text-align:center;}/*!sc*/
.fmnWPj ul li{font:600 14px Montserrat,sans-serif;display:inline-block;*display:block;*zoom:1;height:56px;line-height:56px;white-space:nowrap;margin:0 10px;}/*!sc*/
.fmnWPj ul li svg{margin-top:-3px;width:21px;height:21px;vertical-align:middle;}/*!sc*/
.fmnWPj ul li a{color:#333;-webkit-text-decoration:none;text-decoration:none;}/*!sc*/
.fmnWPj ul li a svg{fill:#333;}/*!sc*/
.fmnWPj ul li a:hover{color:#000;}/*!sc*/
.fmnWPj ul li a:hover svg{fill:#000;}/*!sc*/
.fmnWPj ul li span{cursor:not-allowed;color:#888;}/*!sc*/
.fmnWPj ul li span svg{fill:#888;}/*!sc*/
data-styled.g1[id="pager__StyledPager-sc-60kfqh-0"]{content:"fmnWPj,"}/*!sc*/
.hCYqDj{width:100%;position:relative;font-size:0.9rem;}/*!sc*/
.hCYqDj .wrapper{position:absolute;left:100%;width:280px;margin:0 0 0 4rem;}/*!sc*/
.hCYqDj .wrapper ol{list-style:none;list-style-position:inside;margin:0;padding:0;}/*!sc*/
.hCYqDj .wrapper ol li{border-left:2px solid #ccc;}/*!sc*/
.hCYqDj .wrapper ol a{color:#888;-webkit-text-decoration:none;text-decoration:none;}/*!sc*/
.hCYqDj .wrapper ol a:hover{color:#333;}/*!sc*/
.hCYqDj .wrapper ol .active{border-color:#888;}/*!sc*/
.hCYqDj .wrapper ol .active a{font-weight:700;color:#333;}/*!sc*/
data-styled.g2[id="toc__StyledToc-sc-952njl-0"]{content:"hCYqDj,"}/*!sc*/
.KpbYr{margin:60px auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;height:100px;}/*!sc*/
.KpbYr div{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}/*!sc*/
.KpbYr div a{font-family:Montserrat,sans-serif;font-weight:600;color:#333;-webkit-text-decoration:none;text-decoration:none;}/*!sc*/
.KpbYr div a:hover{color:#000;}/*!sc*/
.KpbYr div a:hover svg path{fill:#000;}/*!sc*/
.KpbYr div a + a{padding-left:11px;}/*!sc*/
.KpbYr svg.github{width:24px;height:24px;}/*!sc*/
.KpbYr svg.mail{width:20px;height:20px;}/*!sc*/
data-styled.g3[id="footer__StyledFooter-sc-1esaulm-0"]{content:"KpbYr,"}/*!sc*/
.fZjKA-D{position:fixed;top:0;left:0;z-index:3;width:100%;background:#fff;}/*!sc*/
.fZjKA-D .container{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:160px;-webkit-transition:height 80ms ease-out;transition:height 80ms ease-out;}/*!sc*/
.fZjKA-D .logo{width:80px;height:80px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}/*!sc*/
.fZjKA-D .links{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;height:100%;}/*!sc*/
.fZjKA-D .links a{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-family:Montserrat,serif;font-weight:600;padding:0.75rem;margin:0 0.25rem;color:#333;line-height:1.2;text-align:center;border-radius:6px;-webkit-text-decoration:none;text-decoration:none;}/*!sc*/
.fZjKA-D .links a:hover{color:#000;}/*!sc*/
.fZjKA-D.scroll{box-shadow:1px 2px 18px rgba(0,0,0,0.1);}/*!sc*/
.fZjKA-D.scroll .container{height:80px;}/*!sc*/
data-styled.g4[id="header__StyledHeader-sc-1e3cys0-0"]{content:"fZjKA-D,"}/*!sc*/
.bsbJEz{margin-top:140px;padding:60px 2rem;min-height:calc(100vh - 360px);}/*!sc*/
data-styled.g5[id="layout__StyledMain-sc-1ubaj6p-0"]{content:"bsbJEz,"}/*!sc*/
.ZuncO header{display:grid;margin-bottom:35px;}/*!sc*/
.ZuncO header h1{margin:0 0 0.5rem;}/*!sc*/
.ZuncO header .post-meta{margin:0 0 0.5rem;}/*!sc*/
.ZuncO header .post-meta *{text-transform:uppercase;line-height:1.6em;-webkit-letter-spacing:1px;-moz-letter-spacing:1px;-ms-letter-spacing:1px;letter-spacing:1px;font-size:12px;color:#a8a8a8;}/*!sc*/
.ZuncO header .post-meta span + span{padding-left:5px;}/*!sc*/
.ZuncO header .post-meta a:hover{color:#333;}/*!sc*/
.ZuncO header .tags{font-size:0.8em;color:#a8a8a8;}/*!sc*/
.ZuncO header .tags a{color:#a8a8a8;}/*!sc*/
.ZuncO header .tags a:hover{color:#333;}/*!sc*/
.ZuncO header .tags .icon-tag{display:inline-block;margin-right:4px;width:14px;height:14px;margin-top:-4px;line-height:inherit;vertical-align:middle;}/*!sc*/
data-styled.g10[id="post__StyledPost-jqgxxz-0"]{content:"ZuncO,"}/*!sc*/
</style><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="icon" href="/favicon-32x32.png?v=dc3dd167ed7792b28c9940c490122b2b"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#FFFFFF"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=dc3dd167ed7792b28c9940c490122b2b"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=dc3dd167ed7792b28c9940c490122b2b"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=dc3dd167ed7792b28c9940c490122b2b"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=dc3dd167ed7792b28c9940c490122b2b"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=dc3dd167ed7792b28c9940c490122b2b"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=dc3dd167ed7792b28c9940c490122b2b"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=dc3dd167ed7792b28c9940c490122b2b"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=dc3dd167ed7792b28c9940c490122b2b"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="alternate" type="application/rss+xml" title="https://johnny-mh.github.io RSS Feed" href="/rss.xml"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/google-fonts/s/montserrat/v14/JTURjIg1_i6t8kCHKm45_bZF3gnD_g.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/google-fonts/s/montserrat/v14/JTUSjIg1_i6t8kCHKm459Wlhyw.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/google-fonts/s/notosanskr/v12/Pby7FmXiEBPT4ITbgNA5CgmOalv477IR.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/google-fonts/s/notosanskr/v12/PbykFmXiEBPT4ITbgNA5CgmG0X7t.woff2"/><style type="text/css">@font-face{font-family:Montserrat;font-style:normal;font-weight:400;src:local('Montserrat Regular'),local('Montserrat-Regular'),url(/google-fonts/s/montserrat/v14/JTUSjIg1_i6t8kCHKm459Wlhyw.woff2) format('woff2'),url(/google-fonts/s/montserrat/v14/JTUSjIg1_i6t8kCHKm459WlhzQ.woff) format('woff');font-display: swap;}@font-face{font-family:Montserrat;font-style:normal;font-weight:600;src:local('Montserrat SemiBold'),local('Montserrat-SemiBold'),url(/google-fonts/s/montserrat/v14/JTURjIg1_i6t8kCHKm45_bZF3gnD_g.woff2) format('woff2'),url(/google-fonts/s/montserrat/v14/JTURjIg1_i6t8kCHKm45_bZF3gnD-A.woff) format('woff');font-display: swap;}@font-face{font-family:'Noto Sans KR';font-style:normal;font-weight:400;src:local('Noto Sans KR Regular'),local('NotoSansKR-Regular'),url(/google-fonts/s/notosanskr/v12/PbykFmXiEBPT4ITbgNA5CgmG0X7t.woff2) format('woff2'),url(/google-fonts/s/notosanskr/v12/PbykFmXiEBPT4ITbgNA5CgmG0X7r.woff) format('woff');font-display: swap;}@font-face{font-family:'Noto Sans KR';font-style:normal;font-weight:700;src:local('Noto Sans KR Bold'),local('NotoSansKR-Bold'),url(/google-fonts/s/notosanskr/v12/Pby7FmXiEBPT4ITbgNA5CgmOalv477IR.woff2) format('woff2'),url(/google-fonts/s/notosanskr/v12/Pby7FmXiEBPT4ITbgNA5CgmOalv477IX.woff) format('woff');font-display: swap;}</style><link as="script" rel="preload" href="/framework-ac0ce6b6325246de4787.js"/><link as="script" rel="preload" href="/component---src-templates-post-jsx-95f2bdd246a0db9d9782.js"/><link as="script" rel="preload" href="/ab548ad425edb8c76955206baeea0d6fe32d4b10-2a2da0fb64f8c059d237.js"/><link as="script" rel="preload" href="/b548615e-3247aaf20cae1403e5bb.js"/><link as="script" rel="preload" href="/2edb282b-4b301732db072f4a89a9.js"/><link as="script" rel="preload" href="/app-34b82ffdabc6183636c8.js"/><link as="script" rel="preload" href="/styles-b9a0d569d0581be7826e.js"/><link as="script" rel="preload" href="/webpack-runtime-5055aefe201d35456092.js"/><link as="fetch" rel="preload" href="/page-data/post/angular의-routerreusestrategy/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="tl-edges"><div class="tl-wrapper tl-wrapper--mount tl-wrapper-status--entered" style="z-index:1;opacity:1"><nav class="header__StyledHeader-sc-1e3cys0-0 fZjKA-D"><div class="container"><div class="brand"><a href="/"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAA5UExURTMzM5WVlfb29mtra3p6eq2trUhISEFBQf///9nZ2ePj41paWu3t7bm5ucTExM/Pz6GhoYiIiE1NTe3wXs0AAANwSURBVHja7dfZkqMgFIBhFKRBXJK8/8MOArLE6HR3qmaqUj83aRTxfCwHWzy+PqI8xMeUr09hAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAiQfwyZbSx7/b74ynpzqdrZrmoafuycr3RWxht6vyK39qt1uclg7/lWLOsgn1/ui3Qlhi0Me/shxJpYYk1NqWpStIMZqqbhx5RLg1HxRo5BbTeHuj6VP3OZVPtyX5SvlDETo1G/WloJ0hkTBtANvRn1KSS/JEN2d4SIydyPAanUlet8+y71WIXbFbNvO4o3INLkQXGjWc8hvXuC9PuDMVo/D3Gx3cwiniFxwO4HiOfn2lrPzs8hYxW17kO3ryB2SdNVIJ3pZR3tEn903+tXEC/pj5BbXpGumpxfQGTzeBem5CVEj2mgM0TMaQ7ULjAyDGy1ZWtI2hAtxD+UZnqpm/4cMjSP68O1DBGujxEWiJ9NW0cbRrdd6Q2kC0PRQvxoLOIwkb+ArG23o9FbqFPOkH2GiLtJCy9D/HDOdbSjH/LJyDOICm5rxj37xhXVpwyziHcgT+NjtzAGU5cM8de3DV9BUqbI0UrTz2YWZxCXICX7VktqMu4tyNymiv58aYXp8xu+hoiw4Uu0szHtAnk5I+1pEU+duDvfgNyaGY1b/xQSNnwDEVsyK9Hq/imFNpA5VJ4hMQecHYbfhjhTT+kSFsYpREgfaAvxEaxVtMfhbpK7fAXpfHo4PQwvIbo+R+b9fIgLxV1Ctg2/thAfnv0eZImdHCDboXh6GF5B9LjEZLmm5TLmMzt2dwEJiaCBhM+pb0CcTdvnCPFp+/QwvIT4MezUkL4YNolZb+o+T/vHyhVkSzotxMdxBbFDKP4lo0xNliGVLgd0ehheLi0XM2D5nk2fv6sUf4fo6RlSn8lHyF7GThy+fm3OAqeH4V82u7wN9zpty24YVO7LqXJPxsBUOeVcbChLxLq0l6qNSKtUdNVjLjK3kvyrCwQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECD/BfIx5fH1EeXxB/4sMuAXKxITAAAAAElFTkSuQmCC" class="logo" alt="JOHNNY DEV"/></a></div><div class="links"><a href="/about">About</a><a href="/archives">Archives</a></div></div></nav><main class="layout__StyledMain-sc-1ubaj6p-0 bsbJEz container"><article class="post__StyledPost-jqgxxz-0 ZuncO"><div class="toc__StyledToc-sc-952njl-0 hCYqDj"><div class="sticky-outer-wrapper"><div class="sticky-inner-wrapper " style="position:relative;top:0px"><div class="wrapper"><ol><li style="padding-left:11px" class="active"><a data-idx="0" href="#-routereusestrategy">🚀 RouteReuseStrategy</a></li><li style="padding-left:11px" class=""><a data-idx="1" href="#routerlink가-동작하지-않아요">RouterLink가 동작하지 않아요</a></li><li style="padding-left:11px" class=""><a data-idx="2" href="#shouldreuseroute는-여러-번-호출된다">shouldReuseRoute는 여러 번 호출된다</a></li><li style="padding-left:11px" class=""><a data-idx="3" href="#상품상세-목록-간-컴포넌트-캐싱-예제">상품상세, 목록 간 컴포넌트 캐싱 예제</a></li></ol></div></div></div></div><header><h1>Angular의 RouteReuseStrategy</h1><div class="post-meta"><span class="date"><time itemProp="datePublished">February 29, 2020</time></span><span class="categories">in<!-- --> <a rel="tag" href="/post/category/development">development</a>, <a rel="tag" href="/post/category/angular">angular</a></span></div><div class="tags"><svg class="icon-tag" preserveAspectRatio="none" viewBox="0 0 20 20"><path fill="#a8a8a8" d="M9 2H2v7l10 10 7-7zM6 8c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"></path></svg><a rel="tag" href="/post/tag/angular">angular</a>, <a rel="tag" href="/post/tag/routereusestrategy">routereusestrategy</a></div></header><div class="markdown-content"><h1 id="-routereusestrategy" style="position:relative;"><a href="#-routereusestrategy" aria-label=" routereusestrategy permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>🚀 RouteReuseStrategy</h1>
<p>Angular는 라우팅 시점마다 RoutingModule에 제공된 Routes 중 이전 페이지와 다음 페이지에 해당하는 Route 객체를 찾아 서로 비교하여 변경이 있을 때만 컴포넌트를 교체한다.</p>
<p>동일한 Route 간 이동 시. 같은 컴포넌트가 렌더링 되며 이뤄지는 API 호출은 중복으로 판단하는 것으로 보인다. 가이드 문서에는 없지만, 이 동작은 개발자가 커스터마이징 할 수 있다.</p>
<p>예를 들면 상세에서 목록으로 뒤로 가기로 이동했을 때는 원래 Route 설정이 달라 컴포넌트를 새로 만들어야 하지만 목록에서 상세로 진입 시점에 목록 컴포넌트 상태를 캐시 했다가 뒤로 가기 시점에 복원하여 API 호출을 줄일 수 있다.</p>
<p>이 <a href="https://itnext.io/cache-components-with-angular-routereusestrategy-3e4c8b174d5f">RouterReuseStrategy API 상세 설명</a>을 간략히 설명하면 아래와 같다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">RouteReuseStrategy</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   * 현재 이동에 컴포넌트 재사용 '여부'를 확인한다
   * false반환 시 재사용없이 컴포넌트를 새로 만들고
   * true를 반환하면 아래 4개의 메서드를 상황별로 호출하여 캐시 및 복원한다
   * (캐시, 복원 로직은 직접 구현해야 한다)
   */</span>
  <span class="token keyword">abstract</span> <span class="token function">shouldReuseRoute</span><span class="token punctuation">(</span>
    future<span class="token operator">:</span> ActivatedRouteSnapshot<span class="token punctuation">,</span>
    curr<span class="token operator">:</span> ActivatedRouteSnapshot
  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span>

  <span class="token comment">/**
   * 페이지를 빠져나갈 때 현재 컴포넌트 캐시 '여부'를 반환한다
   * false 반환 시 캐시 안해도 되는것으로 판단
   * true 반환 시 아래 store메서드를 호출한다
   */</span>
  <span class="token keyword">abstract</span> <span class="token function">shouldDetach</span><span class="token punctuation">(</span>route<span class="token operator">:</span> ActivatedRouteSnapshot<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span>

  <span class="token comment">/**
   * 페이지 빠져나가기 전 상태를 캐시한다
   * 캐시를 위해서 두 번째 인자인 DetachedRouteHandle을 어딘가에 저장하면 된다
   */</span>
  <span class="token keyword">abstract</span> <span class="token function">store</span><span class="token punctuation">(</span>
    route<span class="token operator">:</span> ActivatedRouteSnapshot<span class="token punctuation">,</span>
    handle<span class="token operator">:</span> DetachedRouteHandle <span class="token operator">|</span> <span class="token keyword">null</span>
  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>

  <span class="token comment">/**
   * 페이지 진입 시점에 복원 '여부'를 반환한다
   * false 반환 시 복원 안해도 되는것으로 판단
   * true 반환 시 아래 retrieve메서드를 호출한다
   */</span>
  <span class="token keyword">abstract</span> <span class="token function">shouldAttach</span><span class="token punctuation">(</span>route<span class="token operator">:</span> ActivatedRouteSnapshot<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span>

  <span class="token comment">/**
   * 페이지 진입 시 캐시된 데이터를 복원한다
   * 위에서 구현한 store 메서드 호출 시점에 어딘가에 저장했던 캐시를 반환하면 된다
   */</span>
  <span class="token keyword">abstract</span> <span class="token function">retrieve</span><span class="token punctuation">(</span>route<span class="token operator">:</span> ActivatedRouteSnapshot<span class="token punctuation">)</span><span class="token operator">:</span> DetachedRouteHandle <span class="token operator">|</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span></code></pre></div>
<p>위의 인터페이스를 상속받아 최상위 NgModule에 Providing 해 주면 된다.</p>
<p>Angular의 <a href="https://github.com/angular/angular/blob/5bc39f8c8d5238a9be9bd968cf18ea4b738bd6be/packages/router/src/route_reuse_strategy.ts#L65">DefaultRouteReuseStrategy</a>는 <a href="https://angular.io/api/router/Route">RouteConfig</a>가 같을 때 shouldReuseRoute의 실행 결과를 true로 반환하고 있지만. 각 메서드에서 캐시 여부(shouldDetach), 복원 여부(shouldAttach) 모두 false를 반환하고 있어 아무 일도 일어나지 않는다.</p>
<h1 id="routerlink가-동작하지-않아요" style="position:relative;"><a href="#routerlink%EA%B0%80-%EB%8F%99%EC%9E%91%ED%95%98%EC%A7%80-%EC%95%8A%EC%95%84%EC%9A%94" aria-label="routerlink가 동작하지 않아요 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>RouterLink가 동작하지 않아요</h1>
<p>Angular는 앞서 설명한 대로 라우팅 전, 후의 Route 객체를 비교하여 다를 때만 컴포넌트를 교체한다. 따라서 같은 Route 객체 간 이동이라면 컴포넌트가 교체되지 않는다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">'detail/:id'</span><span class="token punctuation">,</span>
    component<span class="token operator">:</span> DetailComponent<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span></code></pre></div>
<p>위의 라우팅 설정에서 아래 컴포넌트의 링크 클릭해서 <code class="language-text">&#39;/detail/3&#39;</code>에서 <code class="language-text">&#39;/detail/12&#39;</code>로 이동했다면 같은 Route객체(정확히는 같은 ActivatedRouteSnapshot)를 비교한다.</p>
<p>따라서 컴포넌트가 교체되지 않아 <code class="language-text">ngOnInit</code> 을 비롯한 라이프사이클 메서드들이 실행되지 않는다. 만약 <code class="language-text">ngOnInit</code>에서 <code class="language-text">id</code>를 받아 API를 호출해 상세 데이터를 보여주도록 개발했다면 문제가 될 수 있다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts">@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">'app-detail'</span><span class="token punctuation">,</span>
  template<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    &lt;h1>detail component&lt;/h1>
    &lt;a routerLink="/detail/12">go to '/detail/12'&lt;/a>
    &lt;div>{{ content }}&lt;/div>
  </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">DetailComponent</span> <span class="token punctuation">{</span>
  content <span class="token operator">=</span> <span class="token string">''</span>

  <span class="token comment">// '/detail/12'로 이동했을 때는 호출되지 않아 3번 데이터를 계속 보여준다</span>
  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>http
      <span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/detail/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>activatedRoute<span class="token punctuation">.</span>snapshot<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>content <span class="token operator">=</span> o<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>아래 데모를 통해 문제를 확인해 볼 수 있다.</p>
<div class="aspect-ratio">
  <iframe src="https://stackblitz.com/edit/angular-routerlink-notwork?ctl=1&embed=1&file=src/app/detail/detail.component.css&hideExplorer=1&view=preview"></iframe>
</div>
<p>이런 경우 <code class="language-text">ngOnInit</code>이 재실행되지 않아도 갱신되도록 스트림을 이용하여 수정하는 것이 일반적이지만. RouteReuseStrategy를 이용하여 Route 객체 비교를 커스터마이징 할 수 있고. 강제로 컴포넌트를 교체하도록 할 수 있다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CustomRouteReuseStrategy</span> <span class="token keyword">extends</span> <span class="token class-name">RouteReuseStrategy</span> <span class="token punctuation">{</span>
  <span class="token function">shouldDetach</span><span class="token punctuation">(</span><span class="token parameter">route<span class="token operator">:</span> ActivatedRouteSnapshot</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>

  <span class="token function">store</span><span class="token punctuation">(</span><span class="token parameter">route<span class="token operator">:</span> ActivatedRouteSnapshot<span class="token punctuation">,</span> detachedTree<span class="token operator">:</span> DetachedRouteHandle</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token function">shouldAttach</span><span class="token punctuation">(</span><span class="token parameter">route<span class="token operator">:</span> ActivatedRouteSnapshot</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>

  <span class="token function">retrieve</span><span class="token punctuation">(</span><span class="token parameter">route<span class="token operator">:</span> ActivatedRouteSnapshot</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>

  <span class="token function">shouldReuseRoute</span><span class="token punctuation">(</span>
    <span class="token parameter">future<span class="token operator">:</span> ActivatedRouteSnapshot<span class="token punctuation">,</span>
    curr<span class="token operator">:</span> ActivatedRouteSnapshot</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>futureUrl<span class="token punctuation">,</span> currUrl<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>future<span class="token punctuation">,</span> curr<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token operator">=></span>
      o<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">seg</span><span class="token punctuation">)</span> <span class="token operator">=></span> seg<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

    <span class="token comment">/**
     * Route비교 시 둘 다 'detail'을 포함한 path라면 컴포넌트를
     * 재사용하지 않도록 false를 반환한다.
     */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>futureUrl<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'detail'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> currUrl<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'detail'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> future<span class="token punctuation">.</span>routeConfig <span class="token operator">===</span> curr<span class="token punctuation">.</span>routeConfig
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>아래는 위 <code class="language-text">CustomRouteReuseStrategy</code>를 이용한 강제 컴포넌트 교체의 예제이다.</p>
<div class="aspect-ratio">
  <iframe src="https://stackblitz.com/edit/angular-routerlink-notwork-refactor?ctl=1&embed=1&file=src/app/custom-route-reuse-strategy.ts&hideExplorer=1&view=preview"></iframe>
</div>
<h1 id="shouldreuseroute는-여러-번-호출된다" style="position:relative;"><a href="#shouldreuseroute%EB%8A%94-%EC%97%AC%EB%9F%AC-%EB%B2%88-%ED%98%B8%EC%B6%9C%EB%90%9C%EB%8B%A4" aria-label="shouldreuseroute는 여러 번 호출된다 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>shouldReuseRoute는 여러 번 호출된다</h1>
<blockquote>
<p>👀 Angular v8 버전 기준으로 작성했으나 v9 에서도 비슷하게 동작한다</p>
</blockquote>
<p>Angular의 <a href="https://angular.io/api/router/Route">RouteConfig</a>는 재귀적으로 선언할 수 있게 되어있다. 그래서 <code class="language-text">shouldReuseRoute</code>의 <code class="language-text">future</code>, <code class="language-text">curr</code>파라미터는 path에 대한 정보를 트리 구조로 담고 있다. 자세한 내용은 예제를 통해 파악해 보자.</p>
<p>먼저 앱의 라우팅 설정이 아래처럼 선언되어 있다고 가정한다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token comment">// app-routing.module.ts</span>
<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">'list'</span><span class="token punctuation">,</span> component<span class="token operator">:</span> ListComponent <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">'detail/:id'</span><span class="token punctuation">,</span> component<span class="token operator">:</span> DetailComponent <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">'delivery'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">loadChildren</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>
      <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./delivery/delivery.module'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">mod</span><span class="token punctuation">)</span> <span class="token operator">=></span> mod<span class="token punctuation">.</span>DeliveryModule<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token comment">// delivery-routing.module.ts</span>
<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">'detail/:id'</span><span class="token punctuation">,</span> component<span class="token operator">:</span> DeliveryDetailComponent <span class="token punctuation">}</span><span class="token punctuation">]</span></code></pre></div>
<p>아래 <code class="language-text">RouteReuseStrategy</code>는 각 호출 단계에서 url과 해당 <code class="language-text">Route</code>와 연결된 컴포넌트 이름을 출력한다. 이 strategy를 사용하여 위의 Route 설정에서 발생할 수 있는 이동들에 대한 호출 로그를 분석해 보자.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CustomRouteReuseStrategy</span> <span class="token keyword">implements</span> <span class="token class-name">RouteReuseStrategy</span> <span class="token punctuation">{</span>
  <span class="token function">shouldReuseRoute</span><span class="token punctuation">(</span>
    <span class="token parameter">future<span class="token operator">:</span> ActivatedRouteSnapshot<span class="token punctuation">,</span>
    curr<span class="token operator">:</span> ActivatedRouteSnapshot</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 분석을 위해 파라미터를 로깅함</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[future]\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">getInfo</span><span class="token punctuation">(</span>future<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n\n[curr]:\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">getInfo</span><span class="token punctuation">(</span>curr<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n\n----------</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">)</span>

    <span class="token keyword">return</span> future<span class="token punctuation">.</span>routeConfig <span class="token operator">===</span> curr<span class="token punctuation">.</span>routeConfig
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p><em>1. 앱 진입</em></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">[future]
  → &#39;&#39; / null
[curr]:
  → &#39;&#39; / null
----------</code></pre></div>
<p>앱 진입 시점에 한번 호출된다. 큰 의미는 없다</p>
<p><em>2. '' 에서 'list'로 이동하는 경우</em></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">[future]
  → &#39;&#39; / AppComponent
  → &#39;list&#39; / ListComponent
[curr]:
  → &#39;&#39; / null
----------</code></pre></div>
<p><code class="language-text">future</code>를 보면 <code class="language-text">&#39;&#39;</code>는 AppComponent, <code class="language-text">&#39;list&#39;</code>는 ListComponent에 제공되는 것을 알 수 있다.</p>
<p><em>3. 'list'에서 'detail/2'로 이동하는 경우</em></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">[future]
  → &#39;&#39; / AppComponent
  → &#39;detail/2&#39; / DetailComponent
[curr]:
  → &#39;&#39; / AppComponent
  → &#39;list&#39; / ListComponent
----------
[future]
  → &#39;list&#39; / ListComponent
[curr]:
  → &#39;detail/2&#39; / DetailComponent
----------</code></pre></div>
<ul>
<li><code class="language-text">shoudReuseRoute</code>가 두 번 호출되고 있다.</li>
<li>이상한 점이 있는데 두 번째 호출에서는 <code class="language-text">future</code>, <code class="language-text">curr</code>값이 뒤바뀌었다.</li>
<li><code class="language-text">future</code>를 보면 <code class="language-text">AppComponent</code>에는 <code class="language-text">:id</code>에 해당하는 문자열이 없다. 라우팅 설정 자체도 그러한데. <code class="language-text">AppComponent</code>가 DI 받는 <code class="language-text">ActivatedRouteSnapshot</code>에서는 <code class="language-text">id</code>를 가져올 수 없는 이유이기도 하다.</li>
</ul>
<p><em>4. 'detail/2'에서 'delivery/detail/4'로 이동하는 경우</em></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">[future]
  → &#39;&#39; / AppComponent
  → &#39;delivery&#39; / null
  → &#39;detail/4&#39; / DeliveryDetailComponent
[curr]:
  → &#39;&#39; / AppComponent
  → &#39;detail/2&#39; / DetailComponent
----------
[future]
  → &#39;detail/2&#39; / DetailComponent
[curr]:
  → &#39;delivery&#39; / null
  → &#39;detail/4&#39; / DeliveryDetailComponent
----------</code></pre></div>
<ul>
<li>3번처럼 두 번째 호출의 <code class="language-text">future</code>, <code class="language-text">curr</code>값이 뒤바뀌어 있다. <a href="https://github.com/angular/angular/issues/16192">관련 PR</a>이 있는데 아직 별다른 업데이트가 없다.</li>
<li>첫 shouldReuseRoute의 호출에서 <code class="language-text">future</code>파라미터를 보면<code class="language-text">loadChildren</code>을 사용한 <code class="language-text">Route</code>에는 컴포넌트가 없다.</li>
</ul>
<p>두 번씩 호출되는 이유는 어디에도 나와 있지 않지만. <a href="https://github.com/angular/angular/blob/3e51a1998304ab6a15e5bea6bc66e7a8c636a8ad/packages/router/src/create_router_state.ts">관련 코드</a>를 볼 때 두 번씩 호출하더라도 컴포넌트에 올바른 라우팅 상태를 줄 수 있기 때문에 따로 정리하지 않은 것으로 보인다. 따라서 구현 할 때 주의가 필요하다.</p>
<h1 id="상품상세-목록-간-컴포넌트-캐싱-예제" style="position:relative;"><a href="#%EC%83%81%ED%92%88%EC%83%81%EC%84%B8-%EB%AA%A9%EB%A1%9D-%EA%B0%84-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8-%EC%BA%90%EC%8B%B1-%EC%98%88%EC%A0%9C" aria-label="상품상세 목록 간 컴포넌트 캐싱 예제 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>상품상세, 목록 간 컴포넌트 캐싱 예제</h1>
<p>상세, 목록 페이지의 경우 상세에서 뒤로가기 시 이전에 보고 있던 목록과 스크롤을 유지하면 페이지 탐색 사용성을 크게 개선할 수 있다. 특히 전자상거래 서비스의 경우 매출과 직결되는 부분이기도 하다.</p>
<p>캐싱을 위해 일반적으로 bfcache에 의존하거나. 상세 진입 전의 앱 상태를 persist로 저장했다가 복원하는 방법을 사용하는데. 두 방법은 코드베이스 외적인 부분에 의존하기 때문에 관리가 어렵고 사이드이펙트가 있을 수 있다.</p>
<p>RouteReuseStrategy를 이용한 방법은 캐싱이 필요한 구간에 부분적으로 적용해야 하지만 구현이 코드베이스 안에 있으므로 앞서 언급한 문제에서 자유롭다. 가능한 이 방법을 도입하는 것이 좋아 보인다.</p>
<div class="aspect-ratio">
  <iframe src="https://stackblitz.com/edit/angular-list-detail-reuse-example?ctl=1&embed=1&file=src/app/api.service.ts&hideExplorer=1&view=preview"></iframe>
</div>
<p>위 데모는 상품목록 상세 예제이다. 원래라면 상세에서 뒤로 가기로 목록으로 돌아왔을 때 컴포넌트가 교체어 버리므로 화면이 깜빡이며 1번째 페이지부터 새로 그리고. 스크롤 위치도 잃어버린다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CustomRouteReuseStrategy</span> <span class="token keyword">extends</span> <span class="token class-name">RouteReuseStrategy</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> DetachedRouteHandle<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token function">shouldDetach</span><span class="token punctuation">(</span><span class="token parameter">route<span class="token operator">:</span> ActivatedRouteSnapshot</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 목록에서 빠져나갈 때 true반환하여 store를 호출한다</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getPath</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'list'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>

  <span class="token function">store</span><span class="token punctuation">(</span><span class="token parameter">route<span class="token operator">:</span> ActivatedRouteSnapshot<span class="token punctuation">,</span> detachedTree<span class="token operator">:</span> DetachedRouteHandle</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 컴포넌트 상태 캐시</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token function">getPath</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span><span class="token punctuation">,</span> detachedTree<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">shouldAttach</span><span class="token punctuation">(</span><span class="token parameter">route<span class="token operator">:</span> ActivatedRouteSnapshot</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">getPath</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span>

    <span class="token comment">// 목록 재진입 시 캐시가 있다면 true반환하여 retrieve를 호출한다</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'list'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>

  <span class="token function">retrieve</span><span class="token punctuation">(</span><span class="token parameter">route<span class="token operator">:</span> ActivatedRouteSnapshot</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 컴포넌트 상태 복원</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token function">getPath</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">shouldReuseRoute</span><span class="token punctuation">(</span>
    <span class="token parameter">future<span class="token operator">:</span> ActivatedRouteSnapshot<span class="token punctuation">,</span>
    curr<span class="token operator">:</span> ActivatedRouteSnapshot</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> future<span class="token punctuation">.</span>routeConfig <span class="token operator">===</span> curr<span class="token punctuation">.</span>routeConfig
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>하지만 본문에서 설명한 RouteReuseStrategy를 상속한 커스텀 클래스를 구현하면 캐시된 컨텍스트를 복원하기 때문에 상품목록 컴포넌트가 깜빡이지 않고 곧바로 렌더링 되는 것을 볼 수 있다.</p></div></article><nav class="pager__StyledPager-sc-60kfqh-0 fmnWPj"><ul><li class="prev"><a href="/post/Windows에서-VS-Code-vim플러그인-자동-한영전환"><svg class="icon-tag" viewBox="0 0 48 48"><path d="M30.83 14.83L28 12 16 24l12 12 2.83-2.83L21.66 24z"></path><path fill="none" d="M0 0h48v48H0z"></path></svg>Newer</a></li><li class="next"><a href="/post/Ghost-S1-조립컴퓨터-수리">Older<svg class="icon-tag" viewBox="0 0 48 48"><path d="M20 12l-2.83 2.83L26.34 24l-9.17 9.17L20 36l12-12z"></path><path fill="none" d="M0 0h48v48H0z"></path></svg></a></li></ul></nav></main><footer class="footer__StyledFooter-sc-1esaulm-0 KpbYr container"><div><a href="/rss.xml" target="_blank">RSS</a></div><div><a href="https://github.com/johnny-mh" target="_blank" rel="noopener noreferrer"><svg class="github" viewBox="0 0 24 24"><path fill="#333" d="M10.9 2.1c-4.6.5-8.3 4.2-8.8 8.7-.5 4.7 2.2 8.9 6.3 10.5.3.1.6-.1.6-.5v-1.6s-.4.1-.9.1c-1.4 0-2-1.2-2.1-1.9-.1-.4-.3-.7-.6-1-.3-.1-.4-.1-.4-.2 0-.2.3-.2.4-.2.6 0 1.1.7 1.3 1 .5.8 1.1 1 1.4 1 .4 0 .7-.1.9-.2.1-.7.4-1.4 1-1.8-2.3-.5-4-1.8-4-4 0-1.1.5-2.2 1.2-3-.1-.2-.2-.7-.2-1.4 0-.4 0-.9.2-1.3 0-.2.2-.3.3-.3h.1c.5.1 1.5.4 2.4 1.3.6-.2 1.3-.3 2-.3s1.4.1 2 .3c.9-.9 2-1.2 2.5-1.3h.1c.2 0 .3.1.4.3v1.3c0 .8-.1 1.2-.2 1.4.7.8 1.2 1.8 1.2 3 0 2.2-1.7 3.5-4 4 .6.5 1 1.4 1 2.3v2.6c0 .3.3.6.7.5 3.7-1.5 6.3-5.1 6.3-9.3 0-6-5.1-10.7-11.1-10z"></path></svg></a><a href="mailto://romz1212@gmail.com"><svg class="mail" viewBox="0 0 36 36"><path fill="#333" d="M25 12H11l7 6zm0 0"></path><path fill="#333" d="M18 19l-8-7v12h16V12l-8 7zm0 0"></path><path fill="#333" d="M18 0a18 18 0 100 36 18 18 0 000-36zm10 25l-1 1H9l-1-1V11l1-1h18l1 1zm0 0"></path></svg></a></div></footer></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-153662393-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/post/angular의-routerreusestrategy";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-34b82ffdabc6183636c8.js"],"component---src-pages-404-jsx":["/component---src-pages-404-jsx-ae5a85cdc2ae22d70ecf.js"],"component---src-pages-index-jsx":["/component---src-pages-index-jsx-7b2c230e2c7148fc0b14.js"],"component---src-templates-archives-jsx":["/component---src-templates-archives-jsx-12023ddb3f6553a0d1c8.js"],"component---src-templates-page-jsx":["/component---src-templates-page-jsx-6270ff832b7d791d02b0.js"],"component---src-templates-post-jsx":["/component---src-templates-post-jsx-95f2bdd246a0db9d9782.js"],"component---src-templates-posts-jsx":["/component---src-templates-posts-jsx-97de24c22c8760db184c.js"]};/*]]>*/</script><script src="/webpack-runtime-5055aefe201d35456092.js" async=""></script><script src="/styles-b9a0d569d0581be7826e.js" async=""></script><script src="/app-34b82ffdabc6183636c8.js" async=""></script><script src="/2edb282b-4b301732db072f4a89a9.js" async=""></script><script src="/b548615e-3247aaf20cae1403e5bb.js" async=""></script><script src="/ab548ad425edb8c76955206baeea0d6fe32d4b10-2a2da0fb64f8c059d237.js" async=""></script><script src="/component---src-templates-post-jsx-95f2bdd246a0db9d9782.js" async=""></script><script src="/framework-ac0ce6b6325246de4787.js" async=""></script></body></html>